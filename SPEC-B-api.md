# SPEC-B: Telecom Shopping Cart API Specification

**Generated by Claude Sonnet 4.5**  
_Based on SPEC-A architecture design._

## Base URL

`/api/v1`

## Common Domain Models

```typescript
interface Cart {
  id: string;
  items: CartItem[];
  total: number;
  tax: number;
  subtotal: number;
  createdAt: string; // ISO 8601
  expiresAt: string; // ISO 8601
  customerId?: string;
}

interface CartItem {
  id: string;
  productId: string;
  productName: string;
  productType: "device" | "plan" | "addon";
  quantity: number;
  unitPrice: number;
  totalPrice: number;
  metadata?: {
    planType?: "prepaid" | "postpaid";
    dataCap?: string;
    contractLength?: number;
  };
}

interface CheckoutCart {
  orderId: string;
  status: "confirmed" | "pending";
  cart: Cart;
  confirmationNumber: string;
  paymentMethodId: string;
  estimatedDelivery?: string; // ISO 8601
}

// Error Response
interface ErrorResponse {
  error: {
    code: string;
    message: string;
    details?: Record<string, any>;
  };
}
```

### 1. Create Cart

**Endpoint:**

`POST /api/v1/carts`

**Request Body (optional):**

```ts
{
  customerId?: string; // Optional: associate cart with customer
  metadata?: Record<string, any>;  // Optional: store session context
}
```

**Response – 201 Created**

```typescript
{
  id: "cart_7f8a9b2c1d3e4f5g",
  items: [],
  subtotal: 0,
  tax: 0,
  total: 0,
  createdAt: "2025-10-30T14:32:10Z",
  expiresAt: "2025-10-30T15:02:10Z"
}
```

**Errors:**

- 400 INVALID_REQUEST

```ts
{
  error: {
    code: "INVALID_REQUEST",
    message: "Invalid customer ID format",
    details: {
      field: "customerId",
      value: "invalid-id"
    }
  }
}
```

- 500 INTERNAL_ERROR

```ts
{
  error: {
    code: "INTERNAL_ERROR",
    message: "Failed to create cart"
  }
}
```

---

### 2. Get Cart

**Endpoint:**

`GET /api/v1/carts/:cartId`

Path params

`cartId` (string, required) - Cart Identifier

**Response – 200 OK**

```ts
{
  id: "cart_7f8a9b2c1d3e4f5g",
  items: [...],
  subtotal: 1084.99,
  tax: 108.50,
  total: 1193.49,
  createdAt: "...",
  expiresAt: "..."
}
```

**Errors:**

- 400 INVALID_CARD_ID
- 404 CART_NOT_FOUND

---

### 3. Add Item to Cart

**Endpoint:**

`POST /api/v1/carts/:cartId/items`

**Request Body**

```ts
{
  productId: string;
  quantity: number;
  metadata?: {
    planType?: 'prepaid' | 'postpaid';
    contractLength?: number;
    imei?: string;
  };
}
```

---

**Response – 200 OK**

Returns updated cart.

**Errors:**

- 404 CART_NOT_FOUND
- 400 INVALID_ITEM
- 409 INCOMPATIBLE_ITEMS
- 422 PRODUCT_UNAVAILABLE

---

### 4. Remove Item from Cart

**Endpoint:**

`DELETE /api/v1/carts/:cartId/items/:itemId`

Path params

- `cartId` (string, required) - Cart Identifier
- `itemId` (string, required) - Item identifier

**Response – 200 OK**

Returns updated cart.

**Errors:**

- 404 CART_NOT_FOUND
- 404 ITEM_NOT_FOUND

---

### 5. Checkout Cart

**Endpoint:**

`POST /api/v1/carts/:cartId/checkout`

Path params

- `cartId` (string, required) - Cart Identifier

**Request Body:**

```ts
{
  customerId: string;
  paymentMethodId: string;
  shippingAddress?: Address;
  billingAddress?: Address;
  promoCode?: string;
}
```

**Response – 200 OK**

```ts
{
  orderId: "ord_9x8y7z6w5v",
  status: "confirmed",
  confirmationNumber: "CONF-2025-10-30-ABC123",
  estimatedDelivery: "2025-11-03T12:00:00Z"
}
```

**Errors:**

- 404 CART_NOT_FOUND
- 400 EMPTY_CART
- 402 PAYMENT_FAILED
- 409 INVENTORY_UNAVAILABLE
- 422 INVALID_PROMO_CODE

---

### HTTP Status Codes

```bash
Code     Meaning

200     Successful request
201     Cart created
400     Invalid input
402     Payment failed
404     Not found or expired
409     Conflict (e.g., incompatible items)
422     Valid but unprocessable (promo code, inventory)
500     Internal error
```

### Headers

**Rate Limiting**

```bash
X-RateLimit-Limit: 100
X-RateLimit-Remaining: 95
X-RateLimit-Reset: 1698678000
```

**Request**

```bash
Content-Type: application/json
X-Idempotency-Key: <uuid>
X-Request-ID: <uuid>
```

**Response**

```bash
Content-Type: application/json
X-Request-ID: <uuid>
X-Response-Time: 45ms
```

_Note:_
This document serves as the canonical API contract for the Telecom Shopping Cart Experience API.
All endpoints follow RESTful conventions with consistent error formatting and reusable domain models.
